<canvas id="myCanvas" width="200" height="200" style="border:1px solid #000000;">
</canvas>
<script>
var connection = new WebSocket('ws://192.168.1.19:8888/ws');
connection.onmessage = function (e) {
  console.log('Server: ' + e.data);
};
connection.onopen = function () {
  connection.send('Ping'); // Send the message 'Ping' to the server
};
function getMousePos(canvas, evt) {
  var rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}
var c = document.getElementById("myCanvas");
c.addEventListener('mousemove', function(evt) {
  var mousePos = getMousePos(c, evt);
  var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
  //console.log(message);
}, false);
c.addEventListener('mouseup', function(evt) {
  var mousePos = getMousePos(c, evt);
  ogre.dest.x=mousePos.x
  ogre.dest.y=mousePos.y
  //var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
  //console.log(message);
});
function getDiff(v1,v2){
  return {x:v2.x-v1.x,y:v2.y-v1.y}
}
function getAng(v){
  return Math.atan2(v.y,v.x)
}
function getLen(v){
  return Math.sqrt(v.x*v.x+v.y*v.y)
}
function scl(v,s){
  return {x:v.x*s,y:v.y*s}
}
function add(v1,v2){
  return {x:v1.x+v2.x,y:v1.y+v2.y}
}
//imgs=['test.png','testW.png','testW2.png','test180.png']
imgs=['test.png']
ogreAngs=[]
for (var ang=0;ang<360;ang+=45){
  imgs.push('ogre/ogre'+ang+'.png')
  ogreAngs.push('ogre/ogre'+ang+'.png')
}
objs=[]
ogre={pos:{x:0,y:0},dest:{x:0,y:0}}
objs.push(ogre)
imgsLoaded=0
loadedImgs={}
for (s in imgs){
  var img = new Image();
  img.src=imgs[s];
  img.onload=function(){
    imgsLoaded++
    if (imgsLoaded==imgs.length)
      loop()
  };
  loadedImgs[imgs[s]]=img;
}
num=1
which=0
function loop(){
  setTimeout(loop,30);
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
  ctx.clearRect(0, 0, c.width, c.height);
  ctx.beginPath();
  ctx.arc(95,50,40,0,2*Math.PI);
  ctx.stroke();
  ctx.drawImage(loadedImgs['test.png'],20,20,40,40,10,10,70,70);
  //walks=['testW.png','testW2.png','test180.png']
  for (var i in objs){
    var obj=objs[i]
    walks=ogreAngs
    img=loadedImgs[walks[Math.floor(which/2)%walks.length]]
    //img=loadedImgs[ogreAngs[0]]
    var diff=getDiff(ogre.pos,ogre.dest)
    var len=getLen(diff)
    if (len>0){
      var nor=scl(diff,1/len)
      ogre.pos=add(ogre.pos,nor)
      var ang=getAng(nor)/Math.pi*180
      "ogre/ogre"+Math.round(ang/45)*45+".png"
    }
    w=64
    h=64
    rows=4
    cols=5
    ctx.drawImage(img,img.width/cols*(num%cols)+img.width/cols/2-w/2,img.height/rows*Math.floor(num/cols)+img.height/rows/2-h/2,w,h,obj.pos.x-32,obj.pos.y-32,64,64);
    num+=1
    margin=1
    if (num+margin==rows*cols){
      num=1
      which++
    }
  }
}
var ogg = new Audio('test.ogg');
//ogg.src="test.ogg";
//ogg.oncanplay=function(){
//ogg.oncanplaythrough=function(){
ogg.onloadeddata=function(){
  ogg.play();
}
</script>
